---
title: Seleninumì„ ì´ìš©í•œ ìë™í™”
tags: 
    - python
date: 2021-10-14
---


QAë¥¼ ì§„í–‰í• ë–„ ìƒˆë¡œìš´ ì´ìŠˆê°€ ì˜¬ë¼ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•˜ë ¤ë©´ 

> í˜ì´ì§€ ì ‘ì† > refresh > ì´ìŠˆ ê°œìˆ˜ê°€ ëŠ˜ì–´ë‚¬ëŠ”ì§€ í™•ì¸í•˜ê¸° 

ì˜ ê³¼ì •ì„ ê±°ì³ì•¼í•˜ëŠ”ë° .. ë‹¤ë¥¸ì¼í•˜ë‹¤ê°€ ë¦¬í”„ë ˆì‰¬ í•˜ê¸° ê·€ì°®ì•„ì ¸ì„œ crawlerë¥¼ ë§Œë“¤ì—ˆë‹¤.


### ì–¸ì–´ ì„ íƒ 

nodejsì™€ cheerioë¥¼ ì´ìš©í•´ì„œ ë§Œë“¤ê¹Œ ìƒê°í–ˆëŠ”ë° ì´ bug tracking í˜ì´ì§€ì˜ ë¬¸ì œëŠ” ë¡œê·¸ì¸ ê³¼ì •ì´ë‹¤.

> id, pwì…ë ¥ > íœ´ëŒ€í°ìœ¼ë¡œ ì¸ì¦ë²ˆí˜¸ ì…ë ¥ > ë¡œê·¸ì¸ 

ìˆœìœ¼ë¡œ ë¡œê·¸ì¸ì´ ì´ë¤„ì§€ê¸° ë•Œë¬¸ì— ì´ë¯¸ ë„ì›Œì§„ ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•˜ê±°ë‚˜ ,,, ì•„ë‹ˆë©´ ì¸ì¦ë²ˆí˜¸ ë¶€ë¶„ë§Œ ë‚´ê°€ ì…ë ¥í•˜ëŠ” ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì•¼í•œë‹¤.
ê·¸ë˜ì„œ êµ¬ê¸€ë§í•˜ë‹¤ ë°œê²¬í•œê²Œ pythonê³¼ seleniumì„ ì´ìš©í•œ ë°©ë²•ì¸ë° chromedriverë¥¼ ì´ìš©í•´ì„œ ë¸Œë¼ìš°ì € ì°½ì„ ë„ìš´ ë’¤ì— elementë¥¼ ê°€ì ¸ì™€ì„œ
ë‚´ê°€ ì›í•˜ëŠ” ëŒ€ë¡œ í´ë¦­, ì…ë ¥ ì´ë²¤íŠ¸ë¥¼ ìˆ˜í–‰í• ìˆ˜ ìˆì–´ì„œ pythonìœ¼ë¡œ ë§Œë“¤ê¸°ë¡œ í–ˆë‹¤. 

ê·¸ë˜ì„œ ë‚´ê°€ ë§Œë“¤ ìë™í™” ìˆœì„œëŠ” ì´ë ‡ê²Œ ëœë‹¤. 
> ë¡œê·¸ì¸ > ì¸ì¦ë²ˆí˜¸ ìˆ˜ë™ì…ë ¥ > bugìˆ˜ ì²´í¬ > sleep > ìƒˆë¡œê³ ì¹¨ > bugìˆ˜ ë¹„êµ> ìƒˆë¡œìš´ bug ì¶œí˜„ì‹œ slack message ë³´ë‚´ê¸°


### Chrome Driver Download

seleniumì—ì„œ í¬ë¡¬ë¸Œë¼ìš°ì €ë¥¼ ë„ìš¸ë•Œ chrome driverë¥¼ ì´ìš©í•˜ëŠ”ë° ë³¸ì¸ì˜ í¬ë¡¬ ë²„ì „ê³¼ ê°™ì€ ë“œë¼ì´ë²„ë¥¼ 
[ë‹¤ìš´ë¡œë“œ](https://sites.google.com/chromium.org/driver/downloads?authuser=0) í•˜ë©´ ëœë‹¤. 

### Selenium

macì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ python3ì´ ê¹”ë ¤ìˆëŠ”ë°, ê·¸ë˜ì„œ dependency ì¶”ê°€í• ë•Œ pipë§ê³  pip3ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤.  

```
pip3 install selenium
```

ì„¤ì¹˜í›„ python íŒŒì¼ì„ ìƒì„±í•œë‹¤. 
pythonì€ ì²˜ìŒì´ê¸°ë•Œë¬¸ì— [python](https://wikidocs.net/book/2)ì—ì„œ ë¬¸ë²•ì„ ë³´ë©´ì„œ ì‘ì„±í–ˆë‹¤.
seleniumì˜ ê¸°ë³¸ ë¬¸ë²•ì€ [ì´ê³³](https://greeksharifa.github.io/references/2020/10/30/python-selenium-usage/)ì„ ì°¸ê³ í•´ì„œ ì‘ì„±í•˜ì˜€ë‹¤. 


ìš°ì„  ë¸Œë¼ìš°ì €ë¥¼ ì—´ì–´ì•¼ í•˜ëŠ”ë° ì´ë•Œ ìœ„ì—ì„œ ë°›ì€ driverì˜ ê²½ë¡œë¥¼ ì•Œì•„ì•¼í•œë‹¤. 


```
import selenium
from selenium import webdriver

URL = 'url ì£¼ì†Œ'
driver = webdriver.Chrome('driver ê²½ë¡œ')
driver.implicitly_wait(5)
driver.get(url=URL)

```

ì´ë ‡ê²Œ í•˜ë©´ ì…ë ¥í•œ urlì„ í˜¸ì¶œí•œ ë¸Œë¼ìš°ì €ì°½ì´ ì—´ë¦°ë‹¤. 
ì—¬ê¸°ì„œ xpathë¡œ elementë¥¼ ê°€ì ¸ì™€ì„œ id, pw ì…ë ¥ í›„ ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•´ì•¼í•œë‹¤. 
elementëŠ” í¬ë¡¬ì°½ì—ì„œ F12ë¡œ ê°œë°œì ë„êµ¬ë¥¼ ì—° ë‹¤ìŒ ì›í•˜ëŠ” elementë¥¼ í´ë¦­í•˜ë©´ html tagê°€ ë‚˜ì˜¤ëŠ”ë° ì—¬ê¸°ì„œ ì˜¤ë¥¸ìª½ë§ˆìš°ìŠ¤ë¥¼ ëˆŒëŸ¬ì„œ 
copy > copy full xpathë¥¼ í´ë¦­í•˜ë©´ xpath ê²½ë¡œë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. 

![xpath](./xpath.png)

```
id_input = driver.find_element_by_xpath(
    '/html/body/div[1]/form/div/div[1]/input[1]')

```

ì´ëŸ°ì‹ìœ¼ë¡œ ì›í•˜ëŠ” element ê°’ì„ ê°€ì ¸ì˜¨ ë’¤ì— send_keyë¡œ id ê°’ì„ ì…ë ¥í•œ í›„, ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤. 

```
id_input.send_keys('myid')
ActionChains(driver).click(login_btn).perform()
```

ì´ì œ ìˆ˜ë™ìœ¼ë¡œ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³ ë‚˜ë©´ ë¡œê·¸ì¸ ì™„ë£Œëœ í™”ë©´ìœ¼ë¡œ ì§„ì…í•œë‹¤.
ì—¬ê¸°ì„œ ë™ì¼í•˜ê²Œ elementë¥¼ ê°€ì ¸ì™€ì„œ ê°œìˆ˜ ë¹„êµë¥¼ ìœ„í•´ ìƒˆë¡œê³ ì¹¨ì„ í•˜ë ¤ëŠ”ë° ìƒˆë¡œê³ ì¹¨ í›„ elementì— ë°”ë¡œ ì ‘ê·¼í•˜ë©´, í˜ì´ì§€ê°€ ì™„ì „íˆ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ê²½ìš° errorê°€ ë°œìƒí•œë‹¤.
ê·¸ë˜ì„œ ì•”ë¬µì  ëŒ€ê¸°(implicitly_wait) í›„ í˜¸ì¶œí•œë‹¤. 

```
driver.refresh
driver.implicitly_wait(time_to_wait=5)
after_cnt = total_cnt.text
```
ê·¼ë° ì´ë ‡ê²Œ í•˜ë©´ ë¸Œë¼ìš°ì €ë‘ ì—°ê²°ì´ ëŠê¸´ë‹¤ .. 
error logëŠ”  
> selenium.common.exceptions.StaleElementReferenceException: Message: stale element reference: element is not attached to the page document

ì°¾ì•„ë³´ë‹ˆ ë„ˆë¬´ë¹¨ë¦¬ í•´ì„œ ê·¸ë ‡ë‹¤ëŠ”ë° ê·¸ë˜ì„œ ëª…ì‹œì  ëŒ€ê¸°ë¥¼ í˜¸ì¶œí–ˆëŠ”ë°ë„ ë˜‘ê°™ë‹¤
ì™œë‹ˆ ? ì •ë§. .. 

ì´ [ë¸”ë¡œê·¸](https://study-grow.tistory.com/entry/%ED%81%AC%EB%A1%A4%EB%A7%81-%EA%B4%80%EB%A0%A8-selenium-stale-%EC%97%90%EB%9F%AC)ì—ì„œëŠ” sleep ì„ í•˜ë¼ëŠ”ë° 
sleep í•´ë„ ì•ˆëœë‹¤ ^^....


ì´ [ë¸”ë¡œê·¸](https://dockyum.tistory.com/48)ì—ì„œëŠ” element ê°ì²´ë¥¼ ì¬ì‚¬ìš©í•´ì„œ ê·¸ë ‡ë‹¤ê³ í•´ì„œ 
refreshì´í›„ì— elementë¥¼ ìƒˆë¡œìš´ ê°ì²´ë¡œ ë°›ì•„ì™€ì„œ ì‹œë„í•˜ë‹ˆ ì„±ê³µí–ˆë‹¤. 



### Slack Message ë³´ë‚´ê¸° 

ìƒˆë¡œìš´ ë²„ê·¸ê°€ ì˜¬ë¼ì˜¤ë©´ slack ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ê²ƒì´ ì´ ìë™í™”ì˜ í•µì‹¬ì´ê¸° ë•Œë¬¸ì— requests dependencyë¥¼ ì¶”ê°€í•œë‹¤. 

```
pip3 install requests
```

pythonì—ì„œ ìŠ¬ë™ì„ ë³´ë‚´ëŠ” ë²•ì€ [ë¸”ë¡œê·¸](https://somjang.tistory.com/entry/Python-Slack-WebHooks-%EC%9D%84-%ED%86%B5%ED%95%B4-%EC%9E%91%EC%97%85-%EC%A7%84%ED%96%89%EC%83%81%ED%99%A9-%EC%95%8C%EB%A6%BC-%EB%B0%9B%EC%95%84%EB%B3%B4%EA%B8%B0-feat-Incoming-WebHooks)ë¥¼ ì°¸ì¡°í•˜ì˜€ë‹¤.

ê°„ë‹¨í•˜ê²ŒëŠ” webhook urlê³¼ textë¥¼ json ê°ì²´ì— ë‹´ì•„ì„œ requestsë¡œ post í•´ì£¼ë©´ ëœë‹¤. 
ê·¸ë ‡ê²Œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ callí•˜ë©´ ë

```
def send_message_to_slack(text):
    webhook_url = "https://hooks.slack.com/services/"
    payload = {"text": text}
    requests.post(webhook_url, json=payload)
```


### ì‹¤í–‰ 

ê·¸ë ‡ê²Œ ì–´ì©Œêµ¬ì €ì©Œêµ¬ ë§Œë“¤ì–´ì§„ íŒŒì¼ì„ ì‹¤í–‰í•˜ë ¤ë©´ terminalì—ì„œ "python3 íŒŒì¼ëª…" ì„ ì…ë ¥í•˜ë©´ëœë‹¤.  

```
python3 main.py
```

ì™„ì„±ëœ full codeëŠ” 
```
import selenium
from selenium import webdriver
from selenium.webdriver import ActionChains
from time import sleep
import requests


def send_message_to_slack(text):
    webhook_url = "https://hooks.slack.com/services/"
    prj_name = driver.find_element_by_xpath(
        '/html/body/div[1]/div[2]/div[3]/div/div/div[3]/div[1]/div[2]/table/tbody/tr/td[5]')
    payload = {"text": "New Bug Registered in " +
               prj_name.text + " total count : " + text}
    requests.post(webhook_url, json=payload)


URL = ''
driver = webdriver.Chrome('')
driver.implicitly_wait(5)
driver.get(url=URL)

id_input = driver.find_element_by_xpath(
    '/html/body/div[1]/form/div/div[1]/input[1]')
pw_input = driver.find_element_by_xpath(
    '/html/body/div[1]/form/div/div[1]/input[2]')
login_btn = driver.find_element_by_xpath(
    '/html/body/div[1]/form/div/div[1]/input[3]')

id_input.send_keys('')
pw_input.send_keys('')
ActionChains(driver).click(login_btn).perform()

sleep(60)


def check_if_new_bug_open():
    before_cnt = driver.find_element_by_xpath(
        '/html/body/div[1]/div[2]/div[3]/div/div/div[3]/div[1]/div[2]/table/tbody/tr/td[7]')

    print(before_cnt.text)
    before_cnt = before_cnt.text
    sleep(3)
    driver.refresh()
    sleep(5)

    total_cnt = driver.find_element_by_xpath(
        '/html/body/div[1]/div[2]/div[3]/div/div/div[3]/div[1]/div[2]/table/tbody/tr/td[7]')
    # WebDriverWait(driver, 30).until(EC.presence_of_element_located(
    #     (By.XPATH, '/html/body/div[1]/div[2]/div[3]/div/div/div[3]/div[1]/div[2]/table/tbody/tr/td[7]')))
    after_cnt = total_cnt.text
    try:
        if before_cnt < after_cnt:
            send_message_to_slack(after_cnt)
    except:
        print('error')


while True:
    check_if_new_bug_open()

```

ê·¸ëŸ¼ ë¬´í•œë£¨í”„ë¡œ ì‹¤í–‰ë˜ë©´ì„œ slackìœ¼ë¡œ ì•Œë¦¼ì´ ì˜¨ë‹¤ ğŸ‘ğŸ»
![noti](./noti.png)